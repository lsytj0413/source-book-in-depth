# 第二十二章: 打印 #

本章介绍的命令如下:

- pr: 转换文本文件, 从而进行打印操作
- lpr: 打印文件
- lp: 打印文件(System V)
- a2ps: 格式化文件, 以在PostScript打印机上打印
- lpstat: 显示打印状态信息
- lpq: 显示打印机队列状态
- lprm: 取消打印任务
- cancel: 取消打印任务(System V)

## 22.1 打印操作简史 ##

### 22.1.1 灰暗时期的打印 ###

UNIX早期, 打印机贵而集中化, 多个用户共用一台打印机是司空见惯的事.

### 22.1.2 基于字符的打印机 ###

需要打印的字符数据以简单的字节流形式发送给类打印机打印设备, 低编号的ASCII控制码则用于移动打印机的送纸箱和纸张, 以及取代回车, 换行和换页符等.

### 22.1.3 图形化打印机 ###

页面描述语言是一种描述页面内容的编程语言, 第一个主流页面描述语言是Adobe系统的PostScript, 至今仍被广泛使用.

## 22.2 Linux方式的打印 ##

现代Linux系统采取两组软件来执行和管理打印操作: 第一种是CUPS(通用UNIX打印系统), 提供打印驱动程序以及打印任务管理程序; 另一种是GhostScript, 这是一个PostScrit编译器.

## 22.3 准备打印文件 ##

### 22.3.1 pr-将文本文件转换为打印文件 ###

基于字符的打印机使用等宽字体使得每页有固定数目的行并且每行有固定的字符数, pr则用于调整文本以适应特定纸张的大小, 并且可自主选择页眉和页边距.
常见的pr选项如下:

| 选项 | 功能描述 |
|:--|:--|
| +first[:last] | 输出一个从first开始以last结束的页范围 |
| -columns | 将页的内容分成指定的columns列 |
| -a | 默认情况下, 多列输出是垂直列出的, 通过这个选项使内容水平列出 |
| -d | 隔行打印输出 |
| -D format | 用format格式来格式化页眉的显示日期, 可以查看日期命令的man手册页以了解格式字符串的描述 |
| -f | 使用换页符而不是回车符作为页与页之间的分隔符 |
| -h header | 在页眉的中间部分, 使用header代替正在处理的文件名 |
| -l length | 将页的长度设为length, 默认为66行 |
| -n | 对行进行编号 |
| -o offset | 创建一个有offset字符宽的左页边距 |
| -w width | 设定页面宽度为width, 默认为72个字符 |

以下的代码输出 /usr/bin 目录下的内容列表, 并用pr将其格式化为分页的三列的输出:

```
ls /usr/bin | pr -3 -w 65 | head
```

## 22.4 向打印机发送打印任务 ##

CUPS打印组件支持两种打印方法: 一种方法是Berkeley或LPD, 使用lpr命令; 另外一种是SysV, 使用lp命令.

### 22.4.1 lpr-打印文件(Berkeley类型) ###

lpr命令可以将文件送至打印机, 同时由于其支持标准输入, 所以也可用于管道传输.

```
ls /usr/bin | pr -3 | lpr
```

该命令将报告送至系统默认的打印机, 如果想要将文件发送至不同的打印机, 可以使用 -P 选项:

```
lpr -P printer_name
```

此处的printer_name 是指目标打印机的名称, 可以用下面的命令行查看系统打印机列表:

```
lpstat -a
```

许多Linux发行版可以定义一个虚拟打印机, 以输出PDF格式的文件, 而不是真正的物理打印机上打印. 对于某些发行版本, 可能会需要安装额外的软件包(例如cups-pdf) 以支持这一特性.

lpr常用的选项如下表:

| 选项 | 功能描述 |
|:--|:--|
| -# number | 打印number份副本 |
| -p | 每一页都将包括日期, 时间, 工作名称和页码的页眉用阴影打印出来 |
| -P printer | 指定用于输出的打印机名称, 如果未指定则使用系统默认的打印机 |
| -r | 打印结束后删除文件, 适用于那些产生临时打印输出文件的程序 |

### 22.4.2 lp-打印文件(System V类型) ###

lp常用的选项如下表:

| 选项 | 说明 |
|:--|:--|
| -d printer | 设置目标打印机 |
| -n number | 打印number份副本 |
| -o landscape | 将输出设置为横向 |
| -o fitplot | 根据页面大小缩放文件 |
| -o scaling=number | 设置文件缩放比例 |
| -o cpi=number | 设置每英寸输出字符数位为number, 默认为 10 |
| -o lpi=number | 设置每英寸输出指定number行, 默认为 6 |
| -o page-bottom[left/right/top]=points | 设置页边距, 值以点的形式表示, 每英寸有72个点 |
| -P pages | 指定页列表, 页的表达形式可以为用逗号隔开的页列表或是以 [-] 表示的页范围, 例如 1,3,5,7-10 |

例如设置打印的规格为12CPI(字符/英寸) 和 8LPI(行/英寸), 并且左边距为 0.5 英寸.

```
ls /usr/bin | pr -4 -w 90 -l 88 | lp -o page-left=36 -o cpi=12 -o lpi=8
```

### 22.4.3 另外一个参数选项: a2ps ###

a2ps是一个格式转换程序, 原来是指将ASCII格式转换为PostScript格式, 并且用于为PostScript打印机上的打印任务准备文本文件, 现在该命令已经可以将任何格式的文件转换为PostScript格式.

```
ls /usr/bin | pr -3 -t | a2ps -o ~/桌面/ls.ps -L 66
```

该命令行用pr过滤该文本流, 使用 -t 选项省略页眉页脚.

a2ps命令常用的选项如下表:

| 选项 | 功能描述 |
|:--|:--|
| --center-title text | 将中心页标题设置 text |
| --columns number | 将页分成n列, 默认值为2 |
| --footer text | 设置页脚内容为text |
| --guess | 给出输入文件的类型 |
| --left-footer text | 将左页脚内容设为text |
| --left-title text | 将左页标题设置为text |
| --line-numbers=interval | 每interval的间隔对输出文件进行编号 |
| --list=defaults | 显示默认设置 |
| --list=topic | 显示topic的设置 |
| --pages range | 打印range范围内的内容 |
| --right-footer text | 将右页脚内容设为text |
| --right-title text | 将右页标题设置为text |
| --rows number | 将页面分成number行, 默认为1 |
| -B | 无页眉 |
| -b text | 设置页眉内容为text |
| -f size | 使用size点的字体 |
| -l number | 设置每行有number个字符 |
| -L number | 设置每页有number行 |
| -M name | 使用名为name的纸张大小, 例如A4 |
| -n number | 打印n份副本 |
| -o file | 将输出内容送至file, 如果指定为1则是标准输出 |
| -P printer | 使用printer打印机 |
| -R | 纵向排版 |
| -r | 横向排版 |
| -T number | 设置制表符tab作为每一个数字字符的结尾 |
| -u text | 采用底图(水印)技术打印文本纸张 |

## 22.5 监测和控制打印任务 ##

在CUPS中, 每台打印机都有一个打印队列, 其中的任务直到传送到打印机才停下并进行打印, CUPS支持一些命令行程序来管理打印机状态和打印队列.

### 22.5.1 lpstat-显示打印系统状态 ###

lpstat命令可用于确定系统中打印机的名字和有效性. 常用的选项如下表:

| 选项 | 描述 |
|:--|:--|
| -a [printer...] | 显示打印机的队列 |
| -d | 显示系统默认打印机名称 |
| -p [printer...] | 显示printer指定的打印机状态, 若未指定则显示所有打印机状态 |
| -r | 显示打印系统的状态 |
| -s | 显示汇总状态 |
| -t | 显示完整状态报告 |

### 22.5.2 lpq-显示打印队列状态 ###

lpq命令可以查看打印机队列的状态, 从中我们可以看到队列的状态和所包含的打印任务.

```
lpq
# 首先添加一个打印任务, 再查看打印队列
ls *.txt | pr -3 | lp
lpq
```

### 22.5.3 lprm与cancel-删除打印任务 ###

CUPS提供两个程序来从打印机队列中终止并移除打印任务, 一个是Berkeley风格的lprm, 另一个是System V的cancel.

```
cancel 603
```
