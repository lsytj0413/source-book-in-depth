# 第八章: 高级键盘技巧 #

命令行的设计目标有两个: 省事(用最少的击键次数执行最多的任务)和用户在执行任务时手指无需离开键盘(不需要使用鼠标). 本章介绍的命令如下:

- clear: 清屏
- history: 显示历史列表的记录

## 8.1 编辑命令行 ##

Bash使用了一个名为Readline的库来实现命令行的编辑. 需要注意的是, 有些组合键使用了ALT键可能会被GUI识别为其他功能, 当使用虚拟控制台时所有的组合键应该能够正常工作.

### 8.1.1 光标移动 ###

光标移动的组合键如下表:

| 组合键 | 作用           |
| :--    | :--            |
| Ctrl-A | 移动光标到行首 |
| Ctrl-E | 移动光标到行尾 |
| Ctrl-F | 光标向前移动一个字符, 作用同右键 |
| Ctrl-B | 光标向后移动一个字符, 作用同左键 |
| Alt-F | 光标向前移动一个字 |
| Alt-B | 光标向后移动一个字 |
| Ctrl-L | 清屏并把光标移到左上角, 同clear |

### 8.1.2 修改文本 ###

修改文本的组合键如下表:

| 组合键 | 作用           |
| :--    | :--            |
| Ctrl-D | 删除光标处的字符 |
| Ctrl-T | 使光标处的字符和它前面的字符对调位置 |
| Alt-T | 使光标处的字和它前面的字对调位置 |
| Alt-L | 把从光标到字尾的字符转换成小写字母形式 |
| Alt-U | 把从光标到字尾的字符转换成大写字母形式 |

### 8.1.3 剪切和粘贴文本 ###

Readline文档中使用术语killing和yanking来指代通常所说的剪切和粘贴, 被剪切的内容存放在一个称为kill-ring的缓冲区中.

| 组合键 | 作用           |
| :--    | :--            |
| Ctrl-K | 剪切从光标到行尾的文本 |
| Ctrl-U | 剪切从光标到行首的文本 |
| Alt-D | 剪切从光标到当前词尾的文本 |
| Alt-Backspace | 剪切从光标到词头的文本, 如果光标在词头则剪切前一个词 |
| Ctrl-Y | 把kill-ring 缓冲区中的文本粘贴到光标位置 |

## 8.2 自动补齐功能 ##

在输入命令时, 按Tab键将触发自动补齐功能. 自动补齐可以针对路径名, 变量($开头), 用户名(~开头), 主机名(@开头)和命令生效.
主机名的自动补齐只对 /etc/hosts目录下的主机名生效.

| 组合键 | 作用 |
|:--|:--|
| Alt-$ | 显示所有可能的自动补齐列表, 同按两次Tab键 |
| Alt-* | 插入所有可能的匹配项 |

当前版本的Bash提供了一种称为可编程的自动补齐的工具, 允许用户添加附加的自动补齐规则. 可编程的自动补齐通过shell函数来实现. 使用以下命令可以查看这些脚本:

```
set | less
```

## 8.3 使用历史命令 ##

bash会保存使用过的命令的历史记录, 这些记录保存在用户主目录的 .bash_history文件中.

### 8.3.1 搜索历史命令 ###

可以通过如下命令查看历史记录的内容列表:

```
history | less
```
bash默认会保存用户最近使用过的500个命令. 其中每条命令都有个行号, 我们可以使用命令行扩展来使用历史命令:

```
# 使用第88号历史命令
!88
```

bash也支持以递增方式搜索历史记录, 当搜索历史记录时随着输入字符数的增加, bash会相应的改变搜索范围.
按下Ctrl-R键, 接着输入要查找的内容即可以开始递增式搜索. 当找到要查找的内容时, 按Enter键表示执行此命令, 按Ctrl-J将把搜索的内容从历史记录列表中复制到当前命令行. 当要搜索下一个匹配项时可以按下 Ctrl-R键, 按下 Ctrl-G 或者 Ctrl-C即可退出搜索.

| 组合键 | 作用 |
|:--|:--|
| Ctrl-P | 移动到前一条历史记录, 同上方向键 |
| Ctrl-N | 移动到后一条历史记录, 同下方向键 |
| Alt-< | 移动到历史记录列表的开始处 |
| ALt-> | 移动到历史记录列表的结尾处, 即当前命令行 |
| Ctrl-R | 逆向递增搜索 |
| Alt-P | 逆向非递增搜索, 即按下Enter键开始搜索 |
| ALt-N | 向前非递增搜索 |
| Ctrl-O | 执行历史记录列表中的当前项, 执行完跳到下一项 |

### 8.3.2 历史记录扩展 ###

常用的历史记录扩展机制如下表:

| 序列 | 行为 |
|:--|:--|
| !! | 重复最后一个执行的命令, 作用如上方向键+Enter |
| !number | 重复历史记录中第number行的命令 |
| ! string | 重复最近的以string开头的历史记录 |
| !?string | 重复最近的包含string的历史记录 |

以下命令可以将整个shell会话保存到一个文件中:

```
script file
```
如果file未指定则默认为typescript名称.

## 8.4 扩展阅读 ##

- Wikipedia 上有一篇关于计算机终端的好文章:

[http://en.wikipedia.org/wiki/Computer_terminal](http://en.wikipedia.org/wiki/Computer_terminal)
